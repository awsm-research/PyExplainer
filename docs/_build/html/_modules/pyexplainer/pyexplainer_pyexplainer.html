

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pyexplainer.pyexplainer_pyexplainer &mdash; pyexplainer  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> pyexplainer
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conduct.html">Code of Conduct</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pyexplainer</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>pyexplainer.pyexplainer_pyexplainer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyexplainer.pyexplainer_pyexplainer</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">sklearn</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">check_random_state</span>
<span class="c1"># currently for pytest</span>
<span class="kn">from</span> <span class="nn">pyexplainer.rulefit</span> <span class="kn">import</span> <span class="n">RuleFit</span>
<span class="c1"># currently for notebook test</span>
<span class="c1"># from rulefit import RuleFit</span>


<div class="viewcode-block" id="data_validation"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.data_validation">[docs]</a><span class="k">def</span> <span class="nf">data_validation</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate that the given data format is a list of dictionary.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : :obj:`Any`</span>
<span class="sd">        Data to be validated.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    :obj:`bool`</span>
<span class="sd">        True: The data is a list of dictionary.\n</span>
<span class="sd">        False: The data is not a list of dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data Format Error - the input data should be a list of dictionary&quot;</span><span class="p">)</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">valid</span></div>


<div class="viewcode-block" id="id_generator"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.id_generator">[docs]</a><span class="k">def</span> <span class="nf">id_generator</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">check_random_state</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;Generate unique ids for div tag which will contain the visualisation stuff from d3.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : :obj:`int`</span>
<span class="sd">        An integer that specifies the length of the returned id, default = 15. Size should be ion range 1 - 30(both included)</span>
<span class="sd">    random_state : :obj:`np.random.RandomState`, default is None.</span>
<span class="sd">        A RandomState instance.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    :obj:`str`</span>
<span class="sd">        A random identifier.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">random_state</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">mtrand</span><span class="o">.</span><span class="n">RandomState</span><span class="p">):</span>
        <span class="n">random_state</span> <span class="o">=</span> <span class="n">check_random_state</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random_state</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">chars</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span></div>


<div class="viewcode-block" id="to_js_data"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.to_js_data">[docs]</a><span class="k">def</span> <span class="nf">to_js_data</span><span class="p">(</span><span class="n">list_of_dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transform python list to a str to be used inside the html &lt;script&gt;&lt;script/&gt;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    list_of_dict : :obj:`list`</span>
<span class="sd">        Data to be transformed.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    :obj:`str`</span>
<span class="sd">        A str to represent a list of dict ending with &#39;;&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">data_validation</span><span class="p">(</span><span class="n">list_of_dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">list_of_dict</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data to be transformed to the javascript format is not a python list of dict, hence &#39;[</span><span class="si">{}</span><span class="s2">];&#39; is returned&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;[</span><span class="si">{}</span><span class="s1">];&#39;</span></div>


<div class="viewcode-block" id="PyExplainer"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer">[docs]</a><span class="k">class</span> <span class="nc">PyExplainer</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A PyExplainer object is able to load training data and an ML model to generate human-centric explanation and</span>
<span class="sd">    visualisation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X_train : :obj:`pandas.core.frame.DataFrame`</span>
<span class="sd">        Training data X (Features)</span>
<span class="sd">    y_train : :obj:`pandas.core.series.Series`</span>
<span class="sd">        Training data y (Label)</span>
<span class="sd">    indep : :obj:`pandas.core.indexes.base.Index`</span>
<span class="sd">        independent variables (column names)</span>
<span class="sd">    dep : :obj:`str`</span>
<span class="sd">        dependent variables (column name)</span>
<span class="sd">    blackbox_model : :obj:`black box model trained using sklearn`</span>
<span class="sd">        A global black box ML model used to generate the prediction and explanation</span>
<span class="sd">    class_label : :obj:`list`</span>
<span class="sd">        Classification labels, default = [&#39;Clean&#39;, &#39;Defect&#39;]</span>
<span class="sd">    top_k_rules : :obj:`int`</span>
<span class="sd">        Number of top positive and negative rules to be retrieved</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">X_train</span><span class="p">,</span>
                 <span class="n">y_train</span><span class="p">,</span>
                 <span class="n">indep</span><span class="p">,</span>
                 <span class="n">dep</span><span class="p">,</span>
                 <span class="n">blackbox_model</span><span class="p">,</span>
                 <span class="n">class_label</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Clean&#39;</span><span class="p">,</span> <span class="s1">&#39;Defect&#39;</span><span class="p">],</span>
                 <span class="n">top_k_rules</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X_train should be type &#39;pandas.core.frame.DataFrame&#39;&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y_train should be type &#39;pandas.core.series.Series&#39;&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indep</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Index</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indep</span> <span class="o">=</span> <span class="n">indep</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;indep (feature column names) should be type &#39;pandas.core.indexes.base.Index&#39;&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dep</span> <span class="o">=</span> <span class="n">dep</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dep (label column name) should be type &#39;str&#39;&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="c1"># todo- validate blackbox model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blackbox_model</span> <span class="o">=</span> <span class="n">blackbox_model</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">class_label</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_label</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">class_label</span> <span class="o">=</span> <span class="n">class_label</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;class_label should be a list with length of 2&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;class_label should be type &#39;list&#39;&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">top_k_rules</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">top_k_rules</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">top_k_rules</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;top_k_rules should be in range 1 - 15 (both included)&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">top_k_rules</span> <span class="o">=</span> <span class="n">top_k_rules</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;top_k_rules should be type &#39;int&#39;&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bullet_data</span> <span class="o">=</span> <span class="p">[{}]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">risk_data</span> <span class="o">=</span> <span class="p">[{}]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bullet_output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;border&#39;</span><span class="p">:</span> <span class="s1">&#39;3px solid black&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hbox_items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_explain</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_explain</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="PyExplainer.explain"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.explain">[docs]</a>    <span class="k">def</span> <span class="nf">explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">X_explain</span><span class="p">,</span>
                <span class="n">y_explain</span><span class="p">,</span>
                <span class="n">top_k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                <span class="n">max_rules</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                <span class="n">search_function</span><span class="o">=</span><span class="s1">&#39;crossoverinterpolation&#39;</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate Rule Object Manually by passing X_explain and y_explain</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X_explain : :obj:`pandas.core.frame.DataFrame`</span>
<span class="sd">            Features to be explained by the local RuleFit model</span>
<span class="sd">        y_explain : :obj:`pandas.core.series.Series`</span>
<span class="sd">            Label to be explained by the local RuleFit model</span>
<span class="sd">        top_k : :obj:`int`, default is 3</span>
<span class="sd">            Number of top rules to be retrieved</span>
<span class="sd">        max_rules : :obj:`int`, default is 10</span>
<span class="sd">            Number of maximum rules to be generated</span>
<span class="sd">        max_iter : :obj:`int`, default is 10</span>
<span class="sd">            Maximum number of iteration to be tuned in to the local RuleFit model</span>
<span class="sd">        cv : :obj:`int`, default is 5</span>
<span class="sd">            Cross Validation to be tuned in to the local RuleFit model</span>
<span class="sd">        search_function : :obj:`str`, default is &#39;crossoverinterpolation&#39;</span>
<span class="sd">            Name of the search function to be used to generate the instance used by RuleFit.fit()</span>
<span class="sd">        debug : :obj:`bool`, default is False</span>
<span class="sd">            True for debugging mode, False otherwise.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :obj:`dict`</span>
<span class="sd">            A dict rule object including all of the data related to the local RuleFit model with the following keys, &#39;synthetic_data&#39;, &#39;synthetic_predictions&#39;, &#39;X_explain&#39;, &#39;y_explain&#39;, &#39;indep&#39;, &#39;dep&#39;, &#39;top_k_positive_rules&#39;, &#39;top_k_negative_rules&#39;.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pyexplainer.pyexplainer_pyexplainer import PyExplainer</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.ensemble import RandomForestClassifier</span>
<span class="sd">        &gt;&gt;&gt; data = pd.read_csv(&#39;../tests/pyexplainer_test_data/activemq-5.0.0.csv&#39;, index_col = &#39;File&#39;)</span>
<span class="sd">        &gt;&gt;&gt; dep = data.columns[-4]</span>
<span class="sd">        &gt;&gt;&gt; indep = data.columns[0:(len(data.columns) - 4)]</span>
<span class="sd">        &gt;&gt;&gt; X_train = data.loc[:, indep]</span>
<span class="sd">        &gt;&gt;&gt; y_train = data.loc[:, dep]</span>
<span class="sd">        &gt;&gt;&gt; blackbox_model = RandomForestClassifier(max_depth=3, random_state=0)</span>
<span class="sd">        &gt;&gt;&gt; blackbox_model.fit(X_train, y_train)</span>
<span class="sd">        &gt;&gt;&gt; class_label = [&#39;Clean&#39;, &#39;Defect&#39;]</span>
<span class="sd">        &gt;&gt;&gt; pyExp = PyExplainer(X_train, y_train, indep, dep, class_label, blackbox_model)</span>
<span class="sd">        &gt;&gt;&gt; sample_test_data = pd.read_csv(&#39;../tests/pyexplainer_test_data/activemq-5.0.0.csv&#39;, index_col = &#39;File&#39;)</span>
<span class="sd">        &gt;&gt;&gt; X_test = sample_test_data.loc[:, indep]</span>
<span class="sd">        &gt;&gt;&gt; y_test = sample_test_data.loc[:, dep]</span>
<span class="sd">        &gt;&gt;&gt; sample_explain_index = 0</span>
<span class="sd">        &gt;&gt;&gt; X_explain = X_test.iloc[[sample_explain_index]]</span>
<span class="sd">        &gt;&gt;&gt; y_explain = y_test.iloc[[sample_explain_index]]</span>
<span class="sd">        &gt;&gt;&gt; pyExp.explain(X_explain, y_explain, search_function = &#39;crossoverinterpolation&#39;, top_k = 3, max_rules=30, max_iter =5, cv=5, debug = False)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_top_k_rules</span><span class="p">(</span><span class="n">top_k</span><span class="p">)</span>
        <span class="c1"># Step 1 - Generate synthetic instances</span>
        <span class="k">if</span> <span class="n">search_function</span> <span class="o">==</span> <span class="s1">&#39;crossoverinterpolation&#39;</span><span class="p">:</span>
            <span class="n">synthetic_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_instance_crossover_interpolation</span><span class="p">(</span><span class="n">X_explain</span><span class="p">,</span> <span class="n">y_explain</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">search_function</span> <span class="o">==</span> <span class="s1">&#39;randomperturbation&#39;</span><span class="p">:</span>
            <span class="c1"># This random perturbation approach to generate instances is used by LIME to gerate synthetic instances</span>
            <span class="n">synthetic_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_instance_random_perturbation</span><span class="p">(</span><span class="n">X_explain</span><span class="o">=</span><span class="n">X_explain</span><span class="p">,</span>
                                                                          <span class="n">y_explain</span><span class="o">=</span><span class="n">y_explain</span><span class="p">,</span>
                                                                          <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># TODO</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TODO&#39;</span><span class="p">)</span>

        <span class="c1"># Step 2 - Generate predictions of synthetic instances using the global model</span>
        <span class="n">synthetic_instances</span> <span class="o">=</span> <span class="n">synthetic_object</span><span class="p">[</span><span class="s1">&#39;synthetic_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indep</span><span class="p">]</span>
        <span class="n">synthetic_predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blackbox_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">synthetic_instances</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">n_defect_class</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">synthetic_predictions</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nDefect=&#39;</span><span class="p">,</span> <span class="n">n_defect_class</span><span class="p">,</span>
                  <span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">synthetic_predictions</span><span class="p">))</span>

        <span class="c1"># Step 3 - Build a RuleFit local model with synthetic instances</span>
        <span class="c1"># indep_index = [list(synthetic_instances.columns).index(i) for i in self.indep]</span>
        <span class="n">local_rulefit_model</span> <span class="o">=</span> <span class="n">RuleFit</span><span class="p">(</span><span class="n">rfmode</span><span class="o">=</span><span class="s1">&#39;classify&#39;</span><span class="p">,</span>
                                      <span class="n">exp_rand_tree_size</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                      <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                      <span class="n">max_rules</span><span class="o">=</span><span class="n">max_rules</span><span class="p">,</span>
                                      <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
                                      <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span>
                                      <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">local_rulefit_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">synthetic_instances</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                <span class="n">synthetic_predictions</span><span class="p">,</span>
                                <span class="n">feature_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">indep</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Constructed a RuleFit model&#39;</span><span class="p">)</span>

        <span class="c1"># Step 4 Get rules from theRuleFit local model</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="n">local_rulefit_model</span><span class="o">.</span><span class="n">get_rules</span><span class="p">()</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="n">rules</span><span class="p">[</span><span class="n">rules</span><span class="o">.</span><span class="n">coef</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;importance&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="n">rules</span><span class="p">[</span><span class="n">rules</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;rule&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;importance&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">top_k_positive_rules</span> <span class="o">=</span> <span class="n">rules</span><span class="p">[</span><span class="n">rules</span><span class="o">.</span><span class="n">coef</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;importance&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_k</span><span class="p">)</span>
        <span class="n">top_k_positive_rules</span><span class="p">[</span><span class="s1">&#39;Class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_label</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">top_k_negative_rules</span> <span class="o">=</span> <span class="n">rules</span><span class="p">[</span><span class="n">rules</span><span class="o">.</span><span class="n">coef</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;importance&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_k</span><span class="p">)</span>
        <span class="n">top_k_negative_rules</span><span class="p">[</span><span class="s1">&#39;Class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">rule_obj</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;synthetic_data&#39;</span><span class="p">:</span> <span class="n">synthetic_instances</span><span class="p">,</span>
                    <span class="s1">&#39;synthetic_predictions&#39;</span><span class="p">:</span> <span class="n">synthetic_predictions</span><span class="p">,</span>
                    <span class="s1">&#39;X_explain&#39;</span><span class="p">:</span> <span class="n">X_explain</span><span class="p">,</span>
                    <span class="s1">&#39;y_explain&#39;</span><span class="p">:</span> <span class="n">y_explain</span><span class="p">,</span>
                    <span class="s1">&#39;indep&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">indep</span><span class="p">,</span>
                    <span class="s1">&#39;dep&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dep</span><span class="p">,</span>
                    <span class="s1">&#39;top_k_positive_rules&#39;</span><span class="p">:</span> <span class="n">top_k_positive_rules</span><span class="p">,</span>
                    <span class="s1">&#39;top_k_negative_rules&#39;</span><span class="p">:</span> <span class="n">top_k_negative_rules</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">rule_obj</span></div>

<div class="viewcode-block" id="PyExplainer.generate_bullet_data"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.generate_bullet_data">[docs]</a>    <span class="k">def</span> <span class="nf">generate_bullet_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parsed_rule_object</span><span class="p">,</span> <span class="n">X_explain</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate bullet chart data (a list of dict) to be implemented with d3.js chart.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parsed_rule_object : :obj:`dict`</span>
<span class="sd">            Top rules parsed from Rule object.</span>
<span class="sd">        X_explain : :obj:`pandas.core.frame.DataFrame`</span>
<span class="sd">            Explained Dataframe generated from RuleFit model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :obj:`list`</span>
<span class="sd">            A list of dict that contains the data needed to generate a bullet chart.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">min_max_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_min_max_values</span><span class="p">()</span>
        <span class="c1"># Version 01 - only visualise for what to follow (Rules =&gt; Clean)</span>
        <span class="n">bullet_data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parsed_rule_object</span><span class="p">[</span><span class="s1">&#39;top_tofollow_rules&#39;</span><span class="p">])):</span>
            <span class="c1"># {&#39;variable&#39;: &#39;MAJOR_COMMIT&#39;, &#39;lessthan&#39;: True, &#39;value&#39;: &#39;1.550000011920929&#39;}</span>
            <span class="n">tmp_rule</span> <span class="o">=</span> <span class="n">parsed_rule_object</span><span class="p">[</span><span class="s1">&#39;top_tofollow_rules&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">tmp_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">min_max_values</span><span class="p">[</span><span class="s1">&#39;min_values&#39;</span><span class="p">][</span><span class="n">tmp_rule</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]]))</span>
            <span class="n">tmp_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">min_max_values</span><span class="p">[</span><span class="s1">&#39;max_values&#39;</span><span class="p">][</span><span class="n">tmp_rule</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]]))</span>
            <span class="n">tmp_interval</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp_max</span> <span class="o">-</span> <span class="n">tmp_min</span><span class="p">)</span> <span class="o">/</span> <span class="mf">10.0</span>
            <span class="n">tmp_threshold_value</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tmp_rule</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">tmp_actual_value</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">X_explain</span><span class="p">[</span><span class="n">tmp_rule</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">tmp_markers</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmp_actual_value</span><span class="p">]</span>
            <span class="n">plot_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">tmp_min</span><span class="p">,</span> <span class="n">tmp_threshold_value</span> <span class="o">-</span> <span class="n">tmp_interval</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1.0</span>
            <span class="n">plot_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">tmp_max</span><span class="p">,</span> <span class="n">tmp_threshold_value</span> <span class="o">+</span> <span class="n">tmp_interval</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1.0</span>

            <span class="c1"># keep marker in the range</span>
            <span class="k">if</span> <span class="n">tmp_markers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">plot_max</span><span class="p">:</span>
                <span class="n">plot_max</span> <span class="o">=</span> <span class="n">tmp_markers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">tmp_markers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">plot_min</span><span class="p">:</span>
                <span class="n">plot_min</span> <span class="o">=</span> <span class="n">tmp_markers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">diff_plot_max_min</span> <span class="o">=</span> <span class="n">plot_max</span> <span class="o">-</span> <span class="n">plot_min</span>
            <span class="n">tmp_subtitle_text</span> <span class="o">=</span> <span class="s1">&#39;Actual = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tmp_actual_value</span><span class="p">)</span>
            <span class="n">tmp_ticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">plot_min</span><span class="p">,</span> <span class="n">plot_max</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">plot_max</span> <span class="o">-</span> <span class="n">plot_min</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">tmp_step</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tmp_step</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">bullet_total_width</span> <span class="o">=</span> <span class="mi">450</span>
            <span class="n">tmp_startpoints</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">round</span><span class="p">((</span><span class="n">tmp_threshold_value</span> <span class="o">-</span> <span class="n">plot_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">diff_plot_max_min</span> <span class="o">*</span> <span class="n">bullet_total_width</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
            <span class="n">tmp_widths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">((</span><span class="n">tmp_threshold_value</span> <span class="o">-</span> <span class="n">plot_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">diff_plot_max_min</span> <span class="o">*</span> <span class="n">bullet_total_width</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                          <span class="nb">round</span><span class="p">((</span><span class="n">plot_max</span> <span class="o">-</span> <span class="n">tmp_threshold_value</span><span class="p">)</span> <span class="o">/</span> <span class="n">diff_plot_max_min</span> <span class="o">*</span> <span class="n">bullet_total_width</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>

            <span class="nb">id</span> <span class="o">=</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tmp_rule</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">tmp_rule</span><span class="p">[</span><span class="s1">&#39;lessthan&#39;</span><span class="p">]:</span>
                <span class="c1"># lessthan == TRUE:</span>
                <span class="c1"># The rule suggest to decrease the values to less than a certain threshold</span>
                <span class="n">tmp_title_text</span> <span class="o">=</span> <span class="nb">id</span> <span class="o">+</span> <span class="s1">&#39; Decrease the values of &#39;</span> <span class="o">+</span> \
                                 <span class="n">var_name</span> <span class="o">+</span> <span class="s1">&#39; to less than &#39;</span> <span class="o">+</span> \
                                 <span class="nb">str</span><span class="p">(</span><span class="n">tmp_actual_value</span><span class="p">)</span>
                <span class="n">tmp_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#a6d96a&quot;</span><span class="p">,</span> <span class="s2">&quot;#d7191c&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># lessthan == FALSE:</span>
                <span class="c1"># The rule suggest to increase the values to more than a certain threshold</span>
                <span class="n">tmp_title_text</span> <span class="o">=</span> <span class="nb">id</span> <span class="o">+</span> <span class="s1">&#39; Increase the values of &#39;</span> <span class="o">+</span> \
                                 <span class="n">var_name</span> <span class="o">+</span> <span class="s1">&#39; to more than &#39;</span> <span class="o">+</span> \
                                 <span class="nb">str</span><span class="p">(</span><span class="n">tmp_actual_value</span><span class="p">)</span>
                <span class="n">tmp_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#d7191c&quot;</span><span class="p">,</span> <span class="s2">&quot;#a6d96a&quot;</span><span class="p">]</span>

            <span class="n">bullet_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">tmp_title_text</span><span class="p">,</span>
                <span class="s2">&quot;subtitle&quot;</span><span class="p">:</span> <span class="n">tmp_subtitle_text</span><span class="p">,</span>
                <span class="s2">&quot;ticks&quot;</span><span class="p">:</span> <span class="n">tmp_ticks</span><span class="p">,</span>
                <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">tmp_step</span><span class="p">,</span>
                <span class="s2">&quot;startPoints&quot;</span><span class="p">:</span> <span class="n">tmp_startpoints</span><span class="p">,</span>
                <span class="s2">&quot;widths&quot;</span><span class="p">:</span> <span class="n">tmp_widths</span><span class="p">,</span>
                <span class="s2">&quot;colors&quot;</span><span class="p">:</span> <span class="n">tmp_colors</span><span class="p">,</span>
                <span class="s2">&quot;markers&quot;</span><span class="p">:</span> <span class="n">tmp_markers</span><span class="p">,</span>
                <span class="s2">&quot;varRef&quot;</span><span class="p">:</span> <span class="n">var_name</span><span class="p">,</span>
            <span class="p">})</span>
        <span class="k">return</span> <span class="n">bullet_data</span></div>

<div class="viewcode-block" id="PyExplainer.generate_html"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.generate_html">[docs]</a>    <span class="k">def</span> <span class="nf">generate_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate d3 bullet chart html and return it as a String.</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        :obj:`str`</span>
<span class="sd">            html String</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">css_filepath</span> <span class="o">=</span> <span class="s2">&quot;css/styles.css&quot;</span>
        <span class="n">css_stylesheet</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;link rel=&quot;stylesheet&quot; href=&quot;</span><span class="si">%s</span><span class="s2">&quot; /&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">css_filepath</span>

        <span class="n">d3_filepath</span> <span class="o">=</span> <span class="s2">&quot;js/d3.min.js&quot;</span>
        <span class="n">bulletjs_filepath</span> <span class="o">=</span> <span class="s2">&quot;js/bullet.js&quot;</span>
        <span class="n">d3_script</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;script src=&quot;</span><span class="si">%s</span><span class="s2">&quot;&gt;&lt;/script&gt;</span>
<span class="s2">        &lt;script src=&quot;</span><span class="si">%s</span><span class="s2">&quot;&gt;&lt;/script&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">d3_filepath</span><span class="p">,</span> <span class="n">bulletjs_filepath</span><span class="p">)</span>

        <span class="n">main_title</span> <span class="o">=</span> <span class="s2">&quot;What to do to decrease the risk of having defects?&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;div style=&quot;position: relative; top: 0; width: 100vw; left: 27vw;&quot;&gt;</span>
<span class="s2">            &lt;b&gt;</span><span class="si">%s</span><span class="s2">&lt;/b&gt;</span>
<span class="s2">        &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">main_title</span>

        <span class="n">unique_id</span> <span class="o">=</span> <span class="n">id_generator</span><span class="p">()</span>
        <span class="n">bullet_data</span> <span class="o">=</span> <span class="n">to_js_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__get_bullet_data</span><span class="p">())</span>
        <span class="n">risk_data</span> <span class="o">=</span> <span class="n">to_js_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__get_risk_data</span><span class="p">())</span>

        <span class="n">d3_operation_script</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;script&gt;</span>

<span class="s2">        var margin = { top: 5, right: 40, bottom: 20, left: 500 },</span>
<span class="s2">          width = 990 - margin.left - margin.right,</span>
<span class="s2">          height = 50 - margin.top - margin.bottom;</span>

<span class="s2">        var chart = d3.bullet().width(width).height(height);</span>

<span class="s2">        var bulletData = </span><span class="si">%s</span><span class="s2"></span>

<span class="s2">        var riskData = </span><span class="si">%s</span><span class="s2"></span>

<span class="s2">        // define the color of the box</span>
<span class="s2">        var boxColor = &quot;box green&quot;;</span>
<span class="s2">        var riskPred = riskData[0].riskPred[0];</span>
<span class="s2">        if (riskPred.localeCompare(&quot;Yes&quot;)==0) {</span>
<span class="s2">            boxColor = &quot;box orange&quot;;</span>
<span class="s2">        }</span>

<span class="s2">        // append risk prediction and risk score</span>
<span class="s2">        d3.select(&quot;#d3-target-bullet-</span><span class="si">%s</span><span class="s2">&quot;)</span>
<span class="s2">          .append(&quot;div&quot;)</span>
<span class="s2">          .attr(&quot;class&quot;, &quot;riskPred&quot;)</span>
<span class="s2">          .data(riskData)</span>
<span class="s2">          .text((d) =&gt; d.riskPred)</span>
<span class="s2">          .append(&quot;div&quot;)</span>
<span class="s2">          .attr(&quot;class&quot;, boxColor);</span>

<span class="s2">        d3.select(&quot;#d3-target-bullet-</span><span class="si">%s</span><span class="s2">&quot;)</span>
<span class="s2">          .append(&quot;div&quot;)</span>
<span class="s2">          .attr(&quot;class&quot;, &quot;riskScore&quot;)</span>
<span class="s2">          .data(riskData)</span>
<span class="s2">          .text((d) =&gt; &quot;Risk Score: &quot; + d.riskScore);</span>

<span class="s2">        var svg = d3</span>
<span class="s2">          .select(&quot;#d3-target-bullet-</span><span class="si">%s</span><span class="s2">&quot;)</span>
<span class="s2">          .selectAll(&quot;svg&quot;)</span>
<span class="s2">          .data(bulletData)</span>
<span class="s2">          .enter()</span>
<span class="s2">          .append(&quot;svg&quot;)</span>
<span class="s2">          .attr(&quot;class&quot;, &quot;bullet&quot;)</span>
<span class="s2">          .attr(&quot;width&quot;, width + margin.left + margin.right)</span>
<span class="s2">          .attr(&quot;height&quot;, height + margin.top + margin.bottom)</span>
<span class="s2">          .append(&quot;g&quot;)</span>
<span class="s2">          .attr(</span>
<span class="s2">            &quot;transform&quot;,</span>
<span class="s2">            &quot;translate(&quot; + margin.left + &quot;,&quot; + margin.top + &quot;)&quot;</span>
<span class="s2">          )</span>
<span class="s2">          .call(chart);</span>

<span class="s2">        var title = svg</span>
<span class="s2">          .append(&quot;g&quot;)</span>
<span class="s2">          .style(&quot;text-anchor&quot;, &quot;end&quot;)</span>
<span class="s2">          .attr(&quot;transform&quot;, &quot;translate(-6,&quot; + height / 2 + &quot;)&quot;);</span>

<span class="s2">        title</span>
<span class="s2">          .append(&quot;text&quot;)</span>
<span class="s2">          .attr(&quot;class&quot;, &quot;title&quot;)</span>
<span class="s2">          .text((d) =&gt; d.title);</span>

<span class="s2">        title</span>
<span class="s2">          .append(&quot;text&quot;)</span>
<span class="s2">          .attr(&quot;class&quot;, &quot;subtitle&quot;)</span>
<span class="s2">          .attr(&quot;dy&quot;, &quot;1em&quot;)</span>
<span class="s2">          .text((d) =&gt; d.subtitle);</span>

<span class="s2">        &lt;/script&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bullet_data</span><span class="p">,</span> <span class="n">risk_data</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">)</span>

        <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;!DOCTYPE html&gt;</span>
<span class="s2">        &lt;html&gt;</span>
<span class="s2">        &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF8&quot;&gt;</span>
<span class="s2">        &lt;head&gt;</span>
<span class="s2">            </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">            </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">        &lt;/head&gt;</span>
<span class="s2">        &lt;body&gt;</span>
<span class="s2">            &lt;div class=&quot;bullet-chart&quot;&gt;</span>
<span class="s2">                </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">                &lt;div class=&quot;d3-target-bullet&quot; id=&quot;d3-target-bullet-</span><span class="si">%s</span><span class="s2">&quot; /&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">            </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">        &lt;/body&gt;</span>
<span class="s2">        &lt;/html&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">css_stylesheet</span><span class="p">,</span> <span class="n">d3_script</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">,</span> <span class="n">d3_operation_script</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">html</span></div>

<div class="viewcode-block" id="PyExplainer.generate_instance_crossover_interpolation"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.generate_instance_crossover_interpolation">[docs]</a>    <span class="k">def</span> <span class="nf">generate_instance_crossover_interpolation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An approach to generate instance using Crossover and Interpolation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X_test : :obj:`pandas.core.frame.DataFrame`</span>
<span class="sd">            X_test (Testing Features)</span>
<span class="sd">        y_test : :obj:`pandas.core.series.Series`</span>
<span class="sd">            y_test (Testing Label)</span>
<span class="sd">        debug : :obj:`bool`</span>
<span class="sd">            True for debugging mode, False otherwise.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :obj:`dict`</span>
<span class="sd">            A dict with two keys &#39;synthetic_data&#39; and &#39;sampled_class_frequency&#39; generated via</span>
<span class="sd">            Crossover and Interpolation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">categorical_vars</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">X_train_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">y_train_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">X_train_i</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">X_test</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">X_train_i</span> <span class="o">=</span> <span class="n">X_train_i</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indep</span><span class="p">]</span>
        <span class="n">y_train_i</span> <span class="o">=</span> <span class="n">y_train_i</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="bp">self</span><span class="o">.</span><span class="n">dep</span><span class="p">]]</span>

        <span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indep</span><span class="p">]</span>
        <span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="bp">self</span><span class="o">.</span><span class="n">dep</span><span class="p">]]</span>

        <span class="c1"># get the global model predictions for the training set</span>
        <span class="n">target_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blackbox_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_i</span><span class="p">)</span>

        <span class="c1"># class variables</span>
        <span class="c1"># ori_dataset = pd.concat([X_train_i.reset_index(drop=True), y_train_i], axis=1)</span>

        <span class="c1"># Do feature scaling for continuous data and one hot encoding for categorical data</span>
        <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
        <span class="n">trainset_normalize</span> <span class="o">=</span> <span class="n">X_train_i</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">X_train_i</span><span class="p">),</span> <span class="s2">&quot;columns&quot;</span><span class="p">)</span>
        <span class="n">cases_normalize</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">train_objs_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trainset_normalize</span><span class="p">)</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">objs</span><span class="o">=</span><span class="p">[</span><span class="n">trainset_normalize</span><span class="p">,</span> <span class="n">cases_normalize</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indep</span><span class="p">,</span> <span class="s2">&quot;continuous&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indep</span><span class="p">))</span>
        <span class="n">dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indep</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indep</span><span class="p">])</span>
        <span class="c1"># dataset = pd.get_dummies(dataset, prefix_sep=&quot;__&quot;, columns=self.__categorical_vars)</span>
        <span class="n">trainset_normalize</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">dataset</span><span class="p">[:</span><span class="n">train_objs_num</span><span class="p">])</span>
        <span class="n">cases_normalize</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="n">train_objs_num</span><span class="p">:])</span>

        <span class="c1"># make dataframe to store similarities of the trained instances from the explained instance</span>
        <span class="n">dist_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">trainset_normalize</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

        <span class="n">width</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train_i</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.75</span>
        <span class="c1"># similarity</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">cases_normalize</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="c1"># Calculate the euclidean distance from the instance to be explained</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
                <span class="n">trainset_normalize</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">case</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Convert distance to a similarity score</span>
            <span class="n">similarity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">dist</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">width</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
            <span class="n">dist_df</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">similarity</span>
            <span class="n">dist_df</span><span class="p">[</span><span class="s1">&#39;t_target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_train</span>
            <span class="c1"># get the unique classes of the training set</span>
            <span class="n">unique_classes</span> <span class="o">=</span> <span class="n">dist_df</span><span class="o">.</span><span class="n">t_target</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="c1"># Sort similarity scores in to descending order</span>
            <span class="n">dist_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># dist_df.reset_index(inplace=True)</span>

            <span class="c1"># Make a dataframe with top 40 elements in each class</span>
            <span class="n">top_fourty_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">clz</span> <span class="ow">in</span> <span class="n">unique_classes</span><span class="p">:</span>
                <span class="n">top_fourty_df</span> <span class="o">=</span> <span class="n">top_fourty_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dist_df</span><span class="p">[</span><span class="n">dist_df</span><span class="p">[</span><span class="s1">&#39;t_target&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">clz</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span>
            <span class="c1"># top_fourty_df.reset_index(inplace=True)</span>

            <span class="c1"># get the minimum value of the top 40 elements and return the index</span>
            <span class="n">cutoff_similarity</span> <span class="o">=</span> <span class="n">top_fourty_df</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Get the location for the given index with the minimum similarity</span>
            <span class="n">min_loc</span> <span class="o">=</span> <span class="n">dist_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">cutoff_similarity</span><span class="p">)</span>
            <span class="c1"># whole neighbourhood without undersampling the majority class</span>
            <span class="n">train_neigh_sampling_b</span> <span class="o">=</span> <span class="n">dist_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">min_loc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="c1"># get the size of neighbourhood for each class</span>
            <span class="n">target_details</span> <span class="o">=</span> <span class="n">train_neigh_sampling_b</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;t_target&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">target_details</span><span class="p">,</span> <span class="s2">&quot;target_details&quot;</span><span class="p">)</span>
            <span class="n">target_details_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="n">target_details</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;target_count&#39;</span><span class="p">:</span> <span class="n">target_details</span><span class="o">.</span><span class="n">values</span><span class="p">})</span>

            <span class="c1"># Get the majority class and undersample</span>
            <span class="n">final_neighbours_similarity_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">target_details_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;target_count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="n">filterd_class_set</span> <span class="o">=</span> <span class="n">train_neigh_sampling_b</span> \
                        <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_neigh_sampling_b</span><span class="p">[</span><span class="s1">&#39;t_target&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]]</span> \
                        <span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
                    <span class="n">final_neighbours_similarity_df</span> <span class="o">=</span> <span class="n">final_neighbours_similarity_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filterd_class_set</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">filterd_class_set</span> <span class="o">=</span> <span class="n">train_neigh_sampling_b</span> \
                        <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_neigh_sampling_b</span><span class="p">[</span><span class="s1">&#39;t_target&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]]</span>
                    <span class="n">final_neighbours_similarity_df</span> <span class="o">=</span> <span class="n">final_neighbours_similarity_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filterd_class_set</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">final_neighbours_similarity_df</span><span class="p">,</span>
                      <span class="s2">&quot;final_neighbours_similarity_df&quot;</span><span class="p">)</span>
            <span class="c1"># Get the original training set instances which is equal to the index of the selected neighbours</span>
            <span class="n">train_set_neigh</span> <span class="o">=</span> <span class="n">X_train_i</span><span class="p">[</span><span class="n">X_train_i</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">final_neighbours_similarity_df</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">train_set_neigh</span><span class="p">,</span> <span class="s2">&quot;train set neigh&quot;</span><span class="p">)</span>
            <span class="n">train_class_neigh</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">final_neighbours_similarity_df</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>
            <span class="c1"># train_neigh_df = train_set_neigh.join(train_class_neigh)</span>
            <span class="c1"># class_neigh = train_class_neigh.groupby([self.dep]).size()</span>

            <span class="n">new_con_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
            <span class="n">sample_classes_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">sample_indexes_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Generating 1000 instances using interpolation technique</span>
            <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">):</span>
                <span class="n">rand_rows</span> <span class="o">=</span> <span class="n">train_set_neigh</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">sample_indexes_list</span> <span class="o">=</span> <span class="n">sample_indexes_list</span> <span class="o">+</span> <span class="n">rand_rows</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">similarity_both</span> <span class="o">=</span> <span class="n">dist_df</span><span class="p">[</span><span class="n">dist_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rand_rows</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>
                <span class="n">sample_classes</span> <span class="o">=</span> <span class="n">train_class_neigh</span><span class="p">[</span><span class="n">train_class_neigh</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
                    <span class="n">rand_rows</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>
                <span class="n">sample_classes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="n">sample_classes</span><span class="o">.</span><span class="n">to_records</span><span class="p">()</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">))</span>
                <span class="n">sample_classes_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample_classes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

                <span class="n">alpha_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">rand_rows</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">rand_rows</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">new_ins</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">alpha_n</span>
                <span class="n">new_ins</span> <span class="o">=</span> <span class="n">new_ins</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>

                <span class="c1"># For Categorical Variables</span>
                <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">categorical_vars</span><span class="p">:</span>
                    <span class="n">x_df</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
                    <span class="n">y_df</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
                    <span class="c1"># Check similarity of x &gt; similarity of y</span>
                    <span class="k">if</span> <span class="n">similarity_both</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">similarity_both</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;dist&#39;</span><span class="p">]:</span>
                        <span class="n">new_ins</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">cat</span><span class="p">]</span>
                    <span class="c1"># Check similarity of y &gt; similarity of x</span>
                    <span class="k">elif</span> <span class="n">similarity_both</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">similarity_both</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;dist&#39;</span><span class="p">]:</span>
                        <span class="n">new_ins</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">cat</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_ins</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="n">x_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">cat</span><span class="p">],</span> <span class="n">y_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">cat</span><span class="p">]])</span>
                <span class="n">new_ins</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">num</span>
                <span class="n">new_con_df</span> <span class="o">=</span> <span class="n">new_con_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_ins</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Generating 1000 instances using cross-over technique</span>
            <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">):</span>
                <span class="n">rand_rows</span> <span class="o">=</span> <span class="n">train_set_neigh</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">sample_indexes_list</span> <span class="o">=</span> <span class="n">sample_indexes_list</span> <span class="o">+</span> <span class="n">rand_rows</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">sample_classes</span> <span class="o">=</span> <span class="n">train_class_neigh</span><span class="p">[</span><span class="n">train_class_neigh</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rand_rows</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>
                <span class="n">sample_classes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sample_classes</span><span class="o">.</span><span class="n">to_records</span><span class="p">()</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">))</span>
                <span class="n">sample_classes_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample_classes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">mu_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">rand_rows</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">rand_rows</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">rand_rows</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">new_ins</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">mu_f</span>
                <span class="n">new_ins</span> <span class="o">=</span> <span class="n">new_ins</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
                <span class="c1"># For Categorical Variables get the value of the closest instance to the explained instance</span>
                <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">categorical_vars</span><span class="p">:</span>
                    <span class="n">x_df</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
                    <span class="n">y_df</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
                    <span class="n">z_df</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
                    <span class="n">new_ins</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="n">x_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">cat</span><span class="p">],</span> <span class="n">y_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">cat</span><span class="p">],</span> <span class="n">z_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">cat</span><span class="p">]])</span>
                <span class="n">new_ins</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">num</span>
                <span class="n">new_con_df</span> <span class="o">=</span> <span class="n">new_con_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_ins</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># get the global model predictions of the generated instances and the instances in the neighbourhood</span>
            <span class="n">predict_dataset</span> <span class="o">=</span> <span class="n">train_set_neigh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_con_df</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blackbox_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">predict_dataset</span><span class="p">)</span>
            <span class="n">target_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

            <span class="c1"># neighbor_frequency = Counter(tuple(sorted(entry)) for entry in sample_classes_arr)</span>

            <span class="n">new_df_case</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">predict_dataset</span><span class="p">,</span> <span class="n">target_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">new_df_case</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">new_df_case</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">new_df_case</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">y_test</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">sampled_class_frequency</span> <span class="o">=</span> <span class="n">new_df_case</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dep</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>

            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;synthetic_data&#39;</span><span class="p">:</span> <span class="n">new_df_case</span><span class="p">,</span>
                    <span class="s1">&#39;sampled_class_frequency&#39;</span><span class="p">:</span> <span class="n">sampled_class_frequency</span><span class="p">}</span></div>

    <span class="c1"># todo - documentation</span>
<div class="viewcode-block" id="PyExplainer.generate_instance_random_perturbation"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.generate_instance_random_perturbation">[docs]</a>    <span class="k">def</span> <span class="nf">generate_instance_random_perturbation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_explain</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The random perturbation approach to generate synthetic instances which is also used by LIME.&quot;&quot;&quot;</span>
        <span class="n">random_seed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">data_row</span> <span class="o">=</span> <span class="n">X_explain</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indep</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">num_samples</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="n">sampling_method</span> <span class="o">=</span> <span class="s1">&#39;gaussian&#39;</span>
        <span class="n">discretizer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">sample_around_instance</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">scaler</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">(</span><span class="n">with_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indep</span><span class="p">])</span>
        <span class="c1"># distance_metric = &#39;euclidean&#39;</span>
        <span class="n">random_state</span> <span class="o">=</span> <span class="n">check_random_state</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
        <span class="n">is_sparse</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">issparse</span><span class="p">(</span><span class="n">data_row</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_sparse</span><span class="p">:</span>
            <span class="n">num_cols</span> <span class="o">=</span> <span class="n">data_row</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">(</span>
                <span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data_row</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_cols</span> <span class="o">=</span> <span class="n">data_row</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">discretizer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instance_sample</span> <span class="o">=</span> <span class="n">data_row</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">scale_</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">mean_</span>
            <span class="k">if</span> <span class="n">is_sparse</span><span class="p">:</span>
                <span class="c1"># Perturb only the non-zero values</span>
                <span class="n">non_zero_indexes</span> <span class="o">=</span> <span class="n">data_row</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">num_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_zero_indexes</span><span class="p">)</span>
                <span class="n">instance_sample</span> <span class="o">=</span> <span class="n">data_row</span><span class="p">[:,</span> <span class="n">non_zero_indexes</span><span class="p">]</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span><span class="p">[</span><span class="n">non_zero_indexes</span><span class="p">]</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="n">mean</span><span class="p">[</span><span class="n">non_zero_indexes</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">sampling_method</span> <span class="o">==</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_samples</span> <span class="o">*</span> <span class="n">num_cols</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;Invalid input for sampling_method.</span>
<span class="s1">                                 Defaulting to Gaussian sampling.&#39;&#39;&#39;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_samples</span> <span class="o">*</span> <span class="n">num_cols</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sample_around_instance</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">+</span> <span class="n">instance_sample</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">+</span> <span class="n">mean</span>

            <span class="k">if</span> <span class="n">is_sparse</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">num_cols</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">data_row</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data_row</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">non_zero_indexes</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span>
                    <span class="n">indptr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_zero_indexes</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_samples</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_zero_indexes</span><span class="p">)))</span>
                    <span class="n">data_1d_shape</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">data_1d</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">data_1d_shape</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">data_1d</span><span class="p">,</span> <span class="n">indexes</span><span class="p">,</span> <span class="n">indptr</span><span class="p">),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">data_row</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="c1"># first_row = data_row</span>
        <span class="c1"># else:</span>
            <span class="c1"># first_row = discretizer.discretize(data_row)</span>

        <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_row</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">inverse</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># todo - this for-loop is for categorical columns in the future</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        for column in categorical_features:</span>
<span class="sd">            values = feature_values[column]</span>
<span class="sd">            freqs = feature_frequencies[column]</span>
<span class="sd">            inverse_column = random_state.choice(values, size=num_samples,</span>
<span class="sd">                                                 replace=True, p=freqs)</span>
<span class="sd">            binary_column = (inverse_column == first_row[column]).astype(int)</span>
<span class="sd">            binary_column[0] = 1</span>
<span class="sd">            inverse_column[0] = data[0, column]</span>
<span class="sd">            data[:, column] = binary_column</span>
<span class="sd">            inverse[:, column] = inverse_column</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">discretizer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inverse</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">discretizer</span><span class="o">.</span><span class="n">undiscretize</span><span class="p">(</span><span class="n">inverse</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="n">inverse</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_row</span>

        <span class="k">if</span> <span class="n">sp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">issparse</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="c1"># Note in sparse case we don&#39;t subtract mean since data would become dense</span>
            <span class="n">scaled_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">scale_</span><span class="p">)</span>
            <span class="c1"># Multiplying with csr matrix can return a coo sparse matrix</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">isspmatrix_csr</span><span class="p">(</span><span class="n">scaled_data</span><span class="p">):</span>
                <span class="n">scaled_data</span> <span class="o">=</span> <span class="n">scaled_data</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scaled_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">scaler</span><span class="o">.</span><span class="n">mean_</span><span class="p">)</span> <span class="o">/</span> <span class="n">scaler</span><span class="o">.</span><span class="n">scale_</span>
            <span class="c1"># distances = sklearn.metrics.pairwise_distances(scaled_data,</span>
            <span class="c1">#                                               scaled_data[0].reshape(1, -1),</span>
            <span class="c1">#                                               metric=distance_metric).ravel()</span>

        <span class="n">new_df_case</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">scaled_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">indep</span><span class="p">)</span>
        <span class="n">sampled_class_frequency</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">n_defect_class</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blackbox_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">new_df_case</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indep</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random seed&#39;</span><span class="p">,</span> <span class="n">random_seed</span><span class="p">,</span> <span class="s1">&#39;nDefective&#39;</span><span class="p">,</span> <span class="n">n_defect_class</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;synthetic_data&#39;</span><span class="p">:</span> <span class="n">new_df_case</span><span class="p">,</span>
                <span class="s1">&#39;sampled_class_frequency&#39;</span><span class="p">:</span> <span class="n">sampled_class_frequency</span><span class="p">}</span></div>

<div class="viewcode-block" id="PyExplainer.generate_risk_data"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.generate_risk_data">[docs]</a>    <span class="k">def</span> <span class="nf">generate_risk_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_explain</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate risk prediction and risk score to be visualised</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X_explain : :obj:`pandas.core.frame.DataFrame`</span>
<span class="sd">            Explained Dataframe generated from RuleFit model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :obj:`list`</span>
<span class="sd">            A list of dict that contains the data of risk prediction and risk score.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[{</span><span class="s2">&quot;riskScore&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blackbox_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_explain</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span><span class="p">],</span>
                 <span class="s2">&quot;riskPred&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">class_label</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">blackbox_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_explain</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]],</span>
                 <span class="p">}]</span></div>

<div class="viewcode-block" id="PyExplainer.get_risk_pred"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.get_risk_pred">[docs]</a>    <span class="k">def</span> <span class="nf">get_risk_pred</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the risk prediction from risk_data</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        :obj:`str`</span>
<span class="sd">            A string of risk prediction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_risk_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;riskPred&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="PyExplainer.get_risk_score"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.get_risk_score">[docs]</a>    <span class="k">def</span> <span class="nf">get_risk_score</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the risk score from risk_data</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        :obj:`float`</span>
<span class="sd">            A float of risk score</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">risk_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_risk_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;riskScore&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">risk_score</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyExplainer.get_top_k_rules"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.get_top_k_rules">[docs]</a>    <span class="k">def</span> <span class="nf">get_top_k_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Getter of top_k_rules</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        :obj:`int`</span>
<span class="sd">            Number of top positive and negative rules to be retrieved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_k_rules</span></div>

<div class="viewcode-block" id="PyExplainer.generate_progress_bar_items"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.generate_progress_bar_items">[docs]</a>    <span class="k">def</span> <span class="nf">generate_progress_bar_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate items to be set into hbox (horizontal box)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatProgress</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                             <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                             <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                             <span class="n">bar_style</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">,</span>
                                             <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;40%&#39;</span><span class="p">),</span>
                                             <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
        <span class="n">left_text</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Risk Score: &quot;</span><span class="p">)</span>
        <span class="n">right_text</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_hbox_items</span><span class="p">([</span><span class="n">left_text</span><span class="p">,</span> <span class="n">progress_bar</span><span class="p">,</span> <span class="n">right_text</span><span class="p">,</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">)])</span></div>

<div class="viewcode-block" id="PyExplainer.generate_sliders"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.generate_sliders">[docs]</a>    <span class="k">def</span> <span class="nf">generate_sliders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate one or more slider widgets and return as a list.  Slider would be either IntSlider or FloatSlider depending on the value in the data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :obj:`list`</span>
<span class="sd">            A list of slider widgets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">slider_widgets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_bullet_data</span><span class="p">()</span>
        <span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;40%&#39;</span><span class="p">,</span> <span class="s1">&#39;widget_width&#39;</span><span class="p">:</span> <span class="s1">&#39;60%&#39;</span><span class="p">}</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;99%&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s1">&#39;20px&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="c1"># decide to use either IntSlider or FloatSlider</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="c1"># create IntSlider obj and store it into a list</span>
                <span class="n">slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;markers&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="nb">min</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ticks&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="nb">max</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ticks&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">step</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span>
                    <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
                    <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
                    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
                    <span class="n">readout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">readout_format</span><span class="o">=</span><span class="s1">&#39;d&#39;</span>
                <span class="p">)</span>
                <span class="n">slider_widgets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slider</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># create FloatSlider obj and store it into a list</span>
                <span class="n">slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;markers&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="nb">min</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ticks&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="nb">max</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ticks&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">step</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span>
                    <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
                    <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
                    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
                    <span class="n">readout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">readout_format</span><span class="o">=</span><span class="s1">&#39;.1f&#39;</span>
                <span class="p">)</span>
                <span class="n">slider_widgets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slider</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slider_widgets</span></div>

<div class="viewcode-block" id="PyExplainer.on_value_change"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.on_value_change">[docs]</a>    <span class="k">def</span> <span class="nf">on_value_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The callback function for the interactive slider</span>

<span class="sd">        Whenever the user interacts with the slider,</span>
<span class="sd">        If the slider is in the non-continuous update mode,</span>
<span class="sd">        only if the mouse click is released, this callback will be triggered.</span>
<span class="sd">        If the slider is in the continuous update mode (not recommended here),</span>
<span class="sd">        this function will be triggered continuously when the user is moving the slider.</span>

<span class="sd">        This callback will first clear the output of Risk Score Progress Bar and the Bullet Chart.</span>
<span class="sd">        Then it will call funcs to compute the new values to be visualised.</span>
<span class="sd">        When the computing is done, it will soon visualise the new value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        change : :obj:`dict`</span>
<span class="sd">            A dict that contains the former(before changing) and later(after changing) data inside the slider</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># step 1 - clear the bullet chart output and risk score bar output</span>
        <span class="n">bullet_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bullet_output</span>
        <span class="n">bullet_out</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>

        <span class="c1"># step 2 - compute new values to be visualised</span>
        <span class="c1"># get var changed</span>
        <span class="n">bullet_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_bullet_data</span><span class="p">()</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;owner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">))</span>
        <span class="n">var_changed</span> <span class="o">=</span> <span class="n">bullet_data</span><span class="p">[</span><span class="nb">id</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;varRef&#39;</span><span class="p">]</span>
        <span class="n">new_value</span> <span class="o">=</span> <span class="n">change</span><span class="o">.</span><span class="n">new</span>
        <span class="c1"># modify changed var in X_explain</span>
        <span class="n">X_explain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_X_explain</span><span class="p">()</span>
        <span class="n">row_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_X_explain</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">X_explain</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">row_name</span><span class="p">,</span> <span class="n">var_changed</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_value</span>
        <span class="c1"># modify bullet data</span>
        <span class="n">bullet_data</span><span class="p">[</span><span class="nb">id</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;markers&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_bullet_data</span><span class="p">(</span><span class="n">bullet_data</span><span class="p">)</span>
        <span class="c1"># generate new risk data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_risk_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_risk_data</span><span class="p">(</span><span class="n">X_explain</span><span class="p">))</span>

        <span class="c1"># step 3 - visualise new output</span>
        <span class="c1"># update risk score progress bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_bar_animation</span><span class="p">()</span>
        <span class="c1"># update bullet chart</span>
        <span class="k">with</span> <span class="n">bullet_out</span><span class="p">:</span>
            <span class="c1"># display d3 bullet chart</span>
            <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_html</span><span class="p">()</span>
            <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span></div>

<div class="viewcode-block" id="PyExplainer.parse_top_rules"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.parse_top_rules">[docs]</a>    <span class="k">def</span> <span class="nf">parse_top_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top_k_positive_rules</span><span class="p">,</span> <span class="n">top_k_negative_rules</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse top k positive rules and top k negative rules given positive and negative rules as DataFrame</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        top_k_positive_rules : :obj:`pandas.core.frame.DataFrame`</span>
<span class="sd">            Top positive rules DataFrame</span>
<span class="sd">        top_k_negative_rules : :obj:`pandas.core.frame.DataFrame`</span>
<span class="sd">            Top negative rules DataFrame</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :obj:`dict`</span>
<span class="sd">            A dict containing two keys, &#39;top_tofollow_rules&#39; and &#39;top_toavoid_rules&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">top_variables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">top_k_toavoid_rules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">top_k_tofollow_rules</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">top_k_positive_rules</span><span class="p">)):</span>
            <span class="n">tmp_rule</span> <span class="o">=</span> <span class="p">(</span><span class="n">top_k_positive_rules</span><span class="p">[</span><span class="s1">&#39;rule&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">tmp_rule</span> <span class="o">=</span> <span class="n">tmp_rule</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">tmp_rule</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tmp_rule</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">tmp_rule</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">tmp_sub_rule</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="n">tmp_variable</span> <span class="o">=</span> <span class="n">tmp_sub_rule</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">tmp_condition_variable</span> <span class="o">=</span> <span class="n">tmp_sub_rule</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">tmp_value</span> <span class="o">=</span> <span class="n">tmp_sub_rule</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">tmp_variable</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">top_variables</span><span class="p">:</span>
                    <span class="n">top_variables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_variable</span><span class="p">)</span>
                    <span class="n">top_k_toavoid_rules</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="n">tmp_variable</span><span class="p">,</span>
                                                <span class="s1">&#39;lessthan&#39;</span><span class="p">:</span> <span class="n">tmp_condition_variable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">tmp_value</span><span class="p">})</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_k_toavoid_rules</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_top_k_rules</span><span class="p">():</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_k_toavoid_rules</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_top_k_rules</span><span class="p">():</span>
                <span class="k">break</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">top_k_negative_rules</span><span class="p">)):</span>
            <span class="n">tmp_rule</span> <span class="o">=</span> <span class="p">(</span><span class="n">top_k_negative_rules</span><span class="p">[</span><span class="s1">&#39;rule&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">tmp_rule</span> <span class="o">=</span> <span class="n">tmp_rule</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">tmp_rule</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tmp_rule</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">tmp_rule</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">tmp_sub_rule</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="n">tmp_variable</span> <span class="o">=</span> <span class="n">tmp_sub_rule</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">tmp_condition_variable</span> <span class="o">=</span> <span class="n">tmp_sub_rule</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">tmp_value</span> <span class="o">=</span> <span class="n">tmp_sub_rule</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">tmp_variable</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">top_variables</span><span class="p">:</span>
                    <span class="n">top_variables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_variable</span><span class="p">)</span>
                    <span class="n">top_k_tofollow_rules</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="n">tmp_variable</span><span class="p">,</span>
                                                 <span class="s1">&#39;lessthan&#39;</span><span class="p">:</span> <span class="n">tmp_condition_variable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">tmp_value</span><span class="p">})</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_k_tofollow_rules</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_top_k_rules</span><span class="p">():</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_k_tofollow_rules</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_top_k_rules</span><span class="p">():</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;top_tofollow_rules&#39;</span><span class="p">:</span> <span class="n">top_k_tofollow_rules</span><span class="p">,</span>
                <span class="s1">&#39;top_toavoid_rules&#39;</span><span class="p">:</span> <span class="n">top_k_toavoid_rules</span><span class="p">}</span></div>

<div class="viewcode-block" id="PyExplainer.retrieve_min_max_values"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.retrieve_min_max_values">[docs]</a>    <span class="k">def</span> <span class="nf">retrieve_min_max_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the minimum and maximum value from X_train</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :obj:`dict`</span>
<span class="sd">            A dict containing two keys, &#39;min_values&#39; and &#39;max_values&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">min_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">max_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;min_values&#39;</span><span class="p">:</span> <span class="n">min_values</span><span class="p">,</span>
                <span class="s1">&#39;max_values&#39;</span><span class="p">:</span> <span class="n">max_values</span><span class="p">}</span></div>

<div class="viewcode-block" id="PyExplainer.run_bar_animation"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.run_bar_animation">[docs]</a>    <span class="k">def</span> <span class="nf">run_bar_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the animation of Risk Score Progress Bar</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">time</span>
        <span class="n">items_in_hbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_hbox_items</span><span class="p">()</span>
        <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">items_in_hbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">risk_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_risk_score</span><span class="p">()</span>
        <span class="n">risk_prediction</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_risk_pred</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
            <span class="n">risk_prediction</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">risk_prediction</span><span class="p">:</span>
            <span class="n">progress_bar</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bar_color&#39;</span><span class="p">:</span> <span class="s1">&#39;#FA8128&#39;</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">progress_bar</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bar_color&#39;</span><span class="p">:</span> <span class="s1">&#39;#00FF00&#39;</span><span class="p">}</span>

        <span class="c1"># play speed of the animation</span>
        <span class="n">play_speed</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># progress bar animation</span>
        <span class="c1"># count start from the current val of the progress bar</span>
        <span class="n">progress_bar</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">progress_bar</span><span class="o">.</span><span class="n">value</span>
        <span class="n">right_text</span> <span class="o">=</span> <span class="n">items_in_hbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">risk_score</span><span class="p">:</span>
            <span class="n">progress_bar</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="n">play_speed</span>  <span class="c1"># signal to increment the progress bar</span>
            <span class="n">new_progress_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">right_text</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="n">play_speed</span>

            <span class="k">if</span> <span class="n">new_progress_value</span> <span class="o">&gt;</span> <span class="n">risk_score</span><span class="p">:</span>
                <span class="n">right_text</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">risk_score</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">right_text</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_progress_value</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">01</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="n">play_speed</span>
        <span class="c1"># update the right text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_right_text</span><span class="p">(</span><span class="n">right_text</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyExplainer.set_top_k_rules"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.set_top_k_rules">[docs]</a>    <span class="k">def</span> <span class="nf">set_top_k_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top_k_rules</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setter of top_k_rules</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        top_k_rules : :obj:`int`</span>
<span class="sd">            Number of top positive and negative rules to be retrieved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">top_k_rules</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">top_k_rules</span> <span class="o">&gt;</span> <span class="mi">15</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">top_k_rules</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;set top_k_rules failed, top_k_rules should be int in range 1 - 15 (both included)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top_k_rules</span> <span class="o">=</span> <span class="n">top_k_rules</span></div>

<div class="viewcode-block" id="PyExplainer.show_visualisation"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.show_visualisation">[docs]</a>    <span class="k">def</span> <span class="nf">show_visualisation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display items as follows,</span>
<span class="sd">        (1) Risk Score Progress Bar (made from ipywidgets)</span>
<span class="sd">        (2) Interactive Slider (made from ipywidgets)</span>
<span class="sd">        (3) Bullet Chart (Generated By D3.js)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># display risk score progress bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_progress_bar_items</span><span class="p">()</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_hbox_items</span><span class="p">()</span>
        <span class="n">display</span><span class="p">(</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_bar_animation</span><span class="p">()</span>

        <span class="c1"># display sliders</span>
        <span class="n">sliders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_sliders</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">slider</span> <span class="ow">in</span> <span class="n">sliders</span><span class="p">:</span>
            <span class="n">slider</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_value_change</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
            <span class="n">display</span><span class="p">(</span><span class="n">slider</span><span class="p">)</span>

        <span class="n">bullet_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bullet_output</span>
        <span class="n">bullet_out</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
        <span class="n">display</span><span class="p">(</span><span class="n">bullet_out</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">bullet_out</span><span class="p">:</span>
            <span class="c1"># display d3 bullet chart</span>
            <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_html</span><span class="p">()</span>
            <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span></div>

<div class="viewcode-block" id="PyExplainer.update_risk_score"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.update_risk_score">[docs]</a>    <span class="k">def</span> <span class="nf">update_risk_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">risk_score</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the risk score value inside the risk_data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        risk_score : :obj:`int`</span>
<span class="sd">            Value of risk score</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">risk_score</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">risk_score</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__get_risk_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;riskScore&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">risk_score</span></div>

<div class="viewcode-block" id="PyExplainer.update_right_text"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.update_right_text">[docs]</a>    <span class="k">def</span> <span class="nf">update_right_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">right_text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the text on the rightward side of the Risk Score Progress Bar</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        right_text : :obj:`widgets.Label`</span>
<span class="sd">            Text on the rightward side of the Risk Score Progress Bar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right_text</span><span class="p">,</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Label</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__get_hbox_items</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The right_text to be set into hbox_items should be type &#39;ipywidgets.Label&#39;&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="PyExplainer.visualise"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.visualise">[docs]</a>    <span class="k">def</span> <span class="nf">visualise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given the rule object, show all of the visualisation as follows .</span>
<span class="sd">        (1) Risk Score Progress Bar (made from ipywidgets)</span>
<span class="sd">        (2) Interactive Slider (made from ipywidgets)</span>
<span class="sd">        (3) Bullet Chart (Generated By D3.js)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rule_obj : :obj:`dict`</span>
<span class="sd">            A rule dict generated either through loading the .pyobject file or the .explain(...) function</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pyexplainer.pyexplainer_pyexplainer import PyExplainer</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.ensemble import RandomForestClassifier</span>
<span class="sd">        &gt;&gt;&gt; data = pd.read_csv(&#39;../tests/pyexplainer_test_data/activemq-5.0.0.csv&#39;, index_col = &#39;File&#39;)</span>
<span class="sd">        &gt;&gt;&gt; dep = data.columns[-4]</span>
<span class="sd">        &gt;&gt;&gt; indep = data.columns[0:(len(data.columns) - 4)]</span>
<span class="sd">        &gt;&gt;&gt; X_train = data.loc[:, indep]</span>
<span class="sd">        &gt;&gt;&gt; y_train = data.loc[:, dep]</span>
<span class="sd">        &gt;&gt;&gt; blackbox_model = RandomForestClassifier(max_depth=3, random_state=0)</span>
<span class="sd">        &gt;&gt;&gt; blackbox_model.fit(X_train, y_train)</span>
<span class="sd">        &gt;&gt;&gt; class_label = [&#39;Clean&#39;, &#39;Defect&#39;]</span>
<span class="sd">        &gt;&gt;&gt; pyExp = PyExplainer(X_train, y_train, indep, dep, class_label, blackbox_model)</span>
<span class="sd">        &gt;&gt;&gt; sample_test_data = pd.read_csv(&#39;../tests/pyexplainer_test_data/activemq-5.0.0.csv&#39;, index_col = &#39;File&#39;)</span>
<span class="sd">        &gt;&gt;&gt; X_test = sample_test_data.loc[:, indep]</span>
<span class="sd">        &gt;&gt;&gt; y_test = sample_test_data.loc[:, dep]</span>
<span class="sd">        &gt;&gt;&gt; sample_explain_index = 0</span>
<span class="sd">        &gt;&gt;&gt; X_explain = X_test.iloc[[sample_explain_index]]</span>
<span class="sd">        &gt;&gt;&gt; y_explain = y_test.iloc[[sample_explain_index]]</span>
<span class="sd">        &gt;&gt;&gt; rule_obj = pyExp.explain(X_explain, y_explain, search_function = &#39;crossoverinterpolation&#39;, top_k = 3, max_rules=30, max_iter =5, cv=5, debug = False)</span>
<span class="sd">        &gt;&gt;&gt; pyExp.visualise(rule_obj)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visualisation_data_setup</span><span class="p">(</span><span class="n">rule_obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_visualisation</span><span class="p">()</span></div>

<div class="viewcode-block" id="PyExplainer.visualisation_data_setup"><a class="viewcode-back" href="../../source/pyexplainer.html#pyexplainer.pyexplainer_pyexplainer.PyExplainer.visualisation_data_setup">[docs]</a>    <span class="k">def</span> <span class="nf">visualisation_data_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set up the data before visualising them</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rule_obj : :obj:`dict`</span>
<span class="sd">            A rule dict generated either through loading the .pyobject file or the .explain(...) function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">top_rules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_top_rules</span><span class="p">(</span><span class="n">top_k_positive_rules</span><span class="o">=</span><span class="n">rule_obj</span><span class="p">[</span><span class="s1">&#39;top_k_positive_rules&#39;</span><span class="p">],</span>
                                         <span class="n">top_k_negative_rules</span><span class="o">=</span><span class="n">rule_obj</span><span class="p">[</span><span class="s1">&#39;top_k_negative_rules&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_X_explain</span><span class="p">(</span><span class="n">rule_obj</span><span class="p">[</span><span class="s1">&#39;X_explain&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_y_explain</span><span class="p">(</span><span class="n">rule_obj</span><span class="p">[</span><span class="s1">&#39;y_explain&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_bullet_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_bullet_data</span><span class="p">(</span><span class="n">top_rules</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_X_explain</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_risk_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_risk_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__get_X_explain</span><span class="p">()))</span></div>

    <span class="k">def</span> <span class="nf">__get_bullet_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Getter of bullet_data</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        :obj:`list`</span>
<span class="sd">            A list of dict that contains data needed by the d3 bullet chart</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bullet_data</span>

    <span class="k">def</span> <span class="nf">__get_bullet_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Getter of bullet_output</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        :obj:`ipywidgets.Output`</span>
<span class="sd">            A Output object used to wrap and locate contents of visualisation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bullet_output</span>

    <span class="k">def</span> <span class="nf">__get_hbox_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Getter of hbox_items</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        :obj:`list`</span>
<span class="sd">            A list of dict that contains items to be in a horizontal box</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hbox_items</span>

    <span class="k">def</span> <span class="nf">__get_risk_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Getter of risk_data</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        :obj:`list`</span>
<span class="sd">            A list of dict that contains data needed by the d3 bullet chart</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">risk_data</span>

    <span class="k">def</span> <span class="nf">__get_X_explain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Getter of X_explain</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        :obj:`pandas.core.frame.DataFrame`</span>
<span class="sd">            An explained DataFrame containing the features</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_explain</span>

    <span class="k">def</span> <span class="nf">__get_y_explain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Getter of y_explain</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        :obj:`pandas.core.series.Series`</span>
<span class="sd">             An explained DataFrame containing the label</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_explain</span>

    <span class="k">def</span> <span class="nf">__set_bullet_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bullet_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setter of bullet_data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bullet_data : :obj:`list`</span>
<span class="sd">            A list of dict that contains data needed by the d3 bullet chart</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_validation</span><span class="p">(</span><span class="n">bullet_data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bullet_data</span> <span class="o">=</span> <span class="n">bullet_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bullet_data is not in the format of python list of dict&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

    <span class="k">def</span> <span class="nf">__set_bullet_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bullet_output</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setter of bullet_output</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bullet_output : :obj:`widgets.Output`</span>
<span class="sd">            A Output object used to wrap and locate contents of visualisation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bullet_output</span><span class="p">,</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bullet_output</span> <span class="o">=</span> <span class="n">bullet_output</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bullet_output should be type &#39;ipywidgets.Output&#39;&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

    <span class="k">def</span> <span class="nf">__set_hbox_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hbox_items</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setter of hbox_items</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hbox_items : :obj:`list`</span>
<span class="sd">            A list of dict that contains items to be in a horizontal box</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hbox_items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hbox_items</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Label</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hbox_items</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatProgress</span><span class="p">)</span> \
                    <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hbox_items</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Label</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hbox_items</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Label</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hbox_items</span> <span class="o">=</span> <span class="n">hbox_items</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;hbox_items should be in the format of &#39;[widgets.Label, widgets.FloatProgress, widgets.Label, </span>
<span class="s2">                                  widgets.Label]&#39;&quot;&quot;&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;hbox_items should be in the format of &#39;[widgets.Label, widgets.FloatProgress, widgets.Label, </span>
<span class="s2">                  widgets.Label]&#39;&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

    <span class="k">def</span> <span class="nf">__set_risk_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">risk_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setter of risk_data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        risk_data : :obj:`list`</span>
<span class="sd">            A list of dict that contains risk prediction and risk score info</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_validation</span><span class="p">(</span><span class="n">risk_data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">risk_data</span> <span class="o">=</span> <span class="n">risk_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;risk_data is not in the format of python list of dict&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

    <span class="k">def</span> <span class="nf">__set_X_explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_explain</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setter of X_explain</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X_explain : :obj:`pandas.core.frame.DataFrame`</span>
<span class="sd">            An explained DataFrame containing feature cols</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X_explain</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_explain</span> <span class="o">=</span> <span class="n">X_explain</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X_explain should be type &#39;pandas.core.frame.DataFrame&#39;&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

    <span class="k">def</span> <span class="nf">__set_y_explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_explain</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setter of y_explain</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y_explain : :obj:`pandas.core.series.Series`</span>
<span class="sd">            An explained DataFrame containing label col</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y_explain</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_explain</span> <span class="o">=</span> <span class="n">y_explain</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y_explain should be type &#39;pandas.core.series.Series&#39;&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Michael Fu.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>